<!DOCTYPE html>
<html lang="id">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Latihan Ngetik</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background: #e0e5ec;
				min-height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				padding: 20px;
			}

			.container {
				background: #e0e5ec;
				border-radius: 30px;
				padding: 40px;
				max-width: 900px;
				width: 100%;
				box-shadow: 20px 20px 60px #bebebe, -20px -20px 60px #ffffff;
			}

			h1 {
				text-align: center;
				color: #6c63ff;
				margin-bottom: 30px;
				font-size: 2.5em;
				text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8),
					-2px -2px 4px rgba(0, 0, 0, 0.1);
				animation: float 3s ease-in-out infinite;
			}

			@keyframes float {
				0%,
				100% {
					transform: translateY(0px);
				}
				50% {
					transform: translateY(-10px);
				}
			}

			.controls {
				display: flex;
				gap: 15px;
				margin-bottom: 30px;
				flex-wrap: wrap;
				align-items: center;
				justify-content: center;
			}

			.controls label {
				font-weight: bold;
				color: #555;
				text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
			}

			.controls input,
			.controls button {
				padding: 12px 24px;
				border-radius: 15px;
				border: none;
				font-size: 16px;
				font-weight: 600;
				transition: all 0.3s ease;
			}

			.controls input {
				width: 80px;
				text-align: center;
				background: #e0e5ec;
				box-shadow: inset 6px 6px 12px #bebebe, inset -6px -6px 12px #ffffff;
				color: #555;
			}

			.controls input:focus {
				outline: none;
				box-shadow: inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff;
			}

			.controls button {
				background: #e0e5ec;
				color: #6c63ff;
				cursor: pointer;
				box-shadow: 6px 6px 12px #bebebe, -6px -6px 12px #ffffff;
				position: relative;
				overflow: hidden;
			}

			.controls button::before {
				content: "";
				position: absolute;
				top: 50%;
				left: 50%;
				width: 0;
				height: 0;
				border-radius: 50%;
				background: rgba(108, 99, 255, 0.1);
				transform: translate(-50%, -50%);
				transition: width 0.6s, height 0.6s;
			}

			.controls button:hover::before {
				width: 300px;
				height: 300px;
			}

			.controls button:hover {
				transform: translateY(-2px);
				box-shadow: 8px 8px 16px #bebebe, -8px -8px 16px #ffffff;
			}

			.controls button:active {
				box-shadow: inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff;
				transform: translateY(0);
			}

			.controls button span {
				position: relative;
				z-index: 1;
			}

			.stats {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				gap: 20px;
				margin-bottom: 30px;
			}

			.stat-box {
				background: #e0e5ec;
				padding: 20px;
				border-radius: 20px;
				text-align: center;
				box-shadow: 8px 8px 16px #bebebe, -8px -8px 16px #ffffff;
				transition: all 0.3s ease;
				animation: statPulse 2s ease-in-out infinite;
			}

			.stat-box:nth-child(1) {
				animation-delay: 0s;
			}
			.stat-box:nth-child(2) {
				animation-delay: 0.2s;
			}
			.stat-box:nth-child(3) {
				animation-delay: 0.4s;
			}
			.stat-box:nth-child(4) {
				animation-delay: 0.6s;
			}
			.stat-box:nth-child(5) {
				animation-delay: 0.8s;
			}

			@keyframes statPulse {
				0%,
				100% {
					transform: scale(1);
				}
				50% {
					transform: scale(1.02);
				}
			}

			.stat-box:hover {
				transform: translateY(-5px) scale(1.05);
				box-shadow: 12px 12px 24px #bebebe, -12px -12px 24px #ffffff;
			}

			.stat-label {
				font-size: 0.9em;
				color: #888;
				margin-bottom: 8px;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 1px;
			}

			.stat-value {
				font-size: 2em;
				font-weight: bold;
				color: #6c63ff;
				text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
			}

			.sentence-display {
				background: #e0e5ec;
				padding: 30px;
				border-radius: 20px;
				margin-bottom: 25px;
				min-height: 120px;
				display: flex;
				align-items: center;
				justify-content: center;
				box-shadow: inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff;
				transition: all 0.3s ease;
			}

			.sentence-display:hover {
				box-shadow: inset 10px 10px 20px #bebebe,
					inset -10px -10px 20px #ffffff;
			}

			.sentence-text {
				font-size: 1.5em;
				line-height: 1.8;
				color: #555;
				font-family: "Courier New", monospace;
				text-align: center;
			}

			.sentence-text .correct {
				color: #4caf50;
				text-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
				animation: correctChar 0.3s ease;
			}

			.sentence-text .wrong {
				color: #f44336;
				text-shadow: 0 0 10px rgba(244, 67, 54, 0.3);
				animation: shake 0.3s ease;
			}

			@keyframes correctChar {
				0% {
					transform: scale(1);
				}
				50% {
					transform: scale(1.2);
				}
				100% {
					transform: scale(1);
				}
			}

			@keyframes shake {
				0%,
				100% {
					transform: translateX(0);
				}
				25% {
					transform: translateX(-5px);
				}
				75% {
					transform: translateX(5px);
				}
			}

			.input-area {
				margin-bottom: 25px;
			}

			.input-area input {
				width: 100%;
				padding: 18px;
				font-size: 1.3em;
				border: none;
				border-radius: 20px;
				font-family: "Courier New", monospace;
				background: #e0e5ec;
				box-shadow: inset 6px 6px 12px #bebebe, inset -6px -6px 12px #ffffff;
				color: #555;
				transition: all 0.3s ease;
			}

			.input-area input:focus {
				outline: none;
				box-shadow: inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff;
				transform: scale(1.01);
			}

			.input-area input:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			.progress-info {
				text-align: center;
				padding: 18px;
				background: #e0e5ec;
				border-radius: 20px;
				font-size: 1.1em;
				color: #555;
				font-weight: 600;
				box-shadow: 8px 8px 16px #bebebe, -8px -8px 16px #ffffff;
				transition: all 0.3s ease;
			}

			.progress-info:hover {
				transform: scale(1.02);
			}

			.modal {
				display: none;
				position: fixed;
				z-index: 1000;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.3);
				backdrop-filter: blur(5px);
				animation: fadeIn 0.3s;
			}

			.modal-content {
				background: #e0e5ec;
				margin: 5% auto;
				padding: 40px;
				border-radius: 30px;
				max-width: 600px;
				max-height: 80vh;
				overflow-y: auto;
				box-shadow: 20px 20px 60px #bebebe, -20px -20px 60px #ffffff;
				animation: modalSlide 0.5s ease;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
				}
				to {
					opacity: 1;
				}
			}

			@keyframes modalSlide {
				from {
					transform: translateY(-100px) scale(0.8);
					opacity: 0;
				}
				to {
					transform: translateY(0) scale(1);
					opacity: 1;
				}
			}

			.close {
				float: right;
				font-size: 28px;
				font-weight: bold;
				cursor: pointer;
				color: #888;
				transition: all 0.3s;
				width: 40px;
				height: 40px;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				box-shadow: 4px 4px 8px #bebebe, -4px -4px 8px #ffffff;
			}

			.close:hover {
				color: #f44336;
				transform: rotate(90deg);
				box-shadow: 6px 6px 12px #bebebe, -6px -6px 12px #ffffff;
			}

			.highscore-title {
				color: #6c63ff;
				margin-bottom: 25px;
				text-align: center;
				text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
			}

			.highscore-section {
				margin-bottom: 25px;
			}

			.highscore-section h3 {
				color: #555;
				margin-bottom: 15px;
				padding: 10px;
				border-radius: 15px;
				background: #e0e5ec;
				box-shadow: 4px 4px 8px #bebebe, -4px -4px 8px #ffffff;
			}

			.highscore-item {
				background: #e0e5ec;
				padding: 15px;
				margin: 10px 0;
				border-radius: 15px;
				box-shadow: 4px 4px 8px #bebebe, -4px -4px 8px #ffffff;
				transition: all 0.3s ease;
				animation: slideInLeft 0.5s ease;
			}

			.highscore-item:hover {
				transform: translateX(10px);
				box-shadow: 8px 8px 16px #bebebe, -8px -8px 16px #ffffff;
			}

			@keyframes slideInLeft {
				from {
					transform: translateX(-50px);
					opacity: 0;
				}
				to {
					transform: translateX(0);
					opacity: 1;
				}
			}

			/* Particle effects */
			.particle {
				position: fixed;
				width: 10px;
				height: 10px;
				background: #6c63ff;
				border-radius: 50%;
				pointer-events: none;
				animation: particleFloat 3s ease-out forwards;
				box-shadow: 0 0 10px #6c63ff;
			}

			@keyframes particleFloat {
				0% {
					transform: translateY(0) scale(1);
					opacity: 1;
				}
				100% {
					transform: translateY(-100px) scale(0);
					opacity: 0;
				}
			}

			/* Prevent text selection */
			.sentence-text, .sentence-display, .stat-value, .stat-label, .progress-info {
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Typing Test</h1>

			<div class="controls">
				<label for="difficulty">Difficulty:</label>
				<input type="number" id="difficulty" min="1" max="10" value="3" readonly />
				<button onclick="decreaseDifficulty()"><span>&lt;</span></button>
				<button onclick="increaseDifficulty()"><span>&gt;</span></button>
				<button onclick="startSession()"><span>Start</span></button>
				<button onclick="resetSession()"><span>Reset</span></button>
				<button onclick="showHighscores()"><span>Highscores</span></button>
			</div>

			<div class="stats">
				<div class="stat-box">
					<div class="stat-label">Timer</div>
					<div class="stat-value" id="timer">00:00</div>
				</div>
				<div class="stat-box">
					<div class="stat-label">WPM</div>
					<div class="stat-value" id="wpm">0</div>
				</div>
				<div class="stat-box">
					<div class="stat-label">Kalimat</div>
					<div class="stat-value" id="kalimat">0</div>
				</div>
				<div class="stat-box">
					<div class="stat-label">Perfect</div>
					<div class="stat-value" id="perfect">0</div>
				</div>
				<div class="stat-box">
					<div class="stat-label">Typo</div>
					<div class="stat-value" id="mistakes">0</div>
				</div>
			</div>

			<div class="sentence-display">
				<div class="sentence-text" id="sentenceText">
					Pilih difficulty lalu klik Start
				</div>
			</div>

			<div class="input-area">
				<input
					type="text"
					id="inputBox"
					placeholder="Ketik di sini..."
					disabled
				/>
			</div>

			<div class="progress-info" id="progressInfo">Proggres ---</div>
		</div>

		<div id="modal" class="modal">
			<div class="modal-content">
				<span class="close" onclick="closeModal()">&times;</span>
				<div id="modalContent"></div>
			</div>
		</div>

		<script>
			const SENTENCES_LVL1 = [
				"kucing itu suka makan ikan segar setiap pagi",
				"aku belajar mengetik dengan cepat dan akurat",
				"latihan setiap hari akan membuat kamu mahir",
				"focus dan sabar adalah kunci sukses belajar",
				"kecepatan datang dari pengulangan yang konsisten",
				"akurasi lebih penting daripada kecepatan awal",
				"gunakan posisi jari yang benar saat mengetik",
				"baris home adalah fondasi dasar mengetik",
				"jangan melihat keyboard saat berlatih",
				"tetap tenang dan rileks saat mengetik",
				"tekan tombol dengan lembut dan pasti",
				"latihan singkat lebih efektif daripada lama",
				"istirahat untuk menghindari kelelahan tangan",
				"tentukan target kecil yang bisa dicapai",
				"konsistensi mengalahkan intensitas berlebihan",
				"periksa kesalahan dengan teliti setelah latihan",
				"melambat dulu baru nanti bisa cepat",
				"ketik kalimat bukan huruf per huruf",
				"pelajari kombinasi huruf yang sering muncul",
				"latih juga tanda baca dan angka",
				"gunakan kedua tangan secara seimbang",
				"jaga pergelangan tangan tetap terangkat",
				"duduk dengan postur tubuh yang baik",
				"atur ketinggian kursi sesuai meja",
				"fokus membangun memori otot jari",
				"lakukan pemanasan sebelum latihan cepat",
				"akurasi tinggi membangun kepercayaan diri",
				"ukur kemajuan setiap minggu secara rutin",
				"tantang diri sendiri setiap hari",
				"pisahkan latihan berdasarkan tingkat kesulitan",
			];

			const SENTENCES_LVL2 = [
				"python adalah bahasa pemrograman yang mudah dipelajari",
				"function memungkinkan kita menggunakan kode berulang kali",
				"variable menyimpan data di dalam memori komputer",
				"loop mengotomasi tugas yang berulang dengan mudah",
				"conditional membantu program membuat keputusan logis",
				"string adalah urutan karakter yang membentuk teks",
				"list menyimpan koleksi item secara berurutan",
				"dictionary memetakan key ke value dengan efisien",
				"debugging meningkatkan kualitas kode program kita",
				"membaca dokumentasi adalah hal yang sangat penting",
				"tulis test untuk mencegah bug di masa depan",
				"comment menjelaskan logika yang tidak jelas",
				"format kode agar mudah dibaca orang lain",
				"pecah tugas besar menjadi function kecil",
				"pelajari sistem version control seperti git",
				"latih pemikiran algoritma setiap hari",
				"optimize kode hanya setelah melakukan profiling",
				"gunakan nama variable yang jelas dan bermakna",
				"tangani exception dengan cara yang tepat",
				"bangun project kecil untuk melatih skill",
			];

			const SENTENCES_LVL3 = [
				"masalah sinkronisasi bisa sangat sulit untuk direproduksi",
				"memahami concurrency membutuhkan latihan dan pemikiran",
				"urutan inisialisasi module penting di sistem kompleks",
				"maintainability sama pentingnya dengan kecepatan awal",
				"profiling hotspot memandu upaya optimisasi yang terarah",
				"sistem terdistribusi memperkenalkan mode kegagalan baru",
				"test suite yang solid memungkinkan refactoring dengan percaya diri",
				"abstraksi yang jelas mengurangi beban kognitif developer",
				"pesan error yang baik meningkatkan pengalaman debugging",
				"software yang observable dengan metrik mudah dioperasikan",
			];

			const SENTENCES_LVL4 = [
				"arsitektur mikroservis menawarkan fleksibilitas dalam pengembangan",
				"containerisasi memudahkan deployment aplikasi modern",
				"api gateway menjadi titik masuk utama dalam sistem terdistribusi",
				"load balancing mendistribusikan beban secara merata",
				"cache layer meningkatkan performa aplikasi secara signifikan",
				"message queue memungkinkan komunikasi asinkron antar layanan",
				"event sourcing menyimpan perubahan sebagai rangkaian event",
				"cqrs memisahkan operasi baca dan tulis untuk efisiensi",
				"domain driven design memetakan model bisnis ke kode",
				"hexagonal architecture memisahkan logika inti dari infrastruktur",
			];

			const SENTENCES_LVL5 = [
				"machine learning memungkinkan sistem belajar dari data",
				"neural network meniru struktur otak dalam pemrosesan informasi",
				"deep learning menggunakan lapisan tersembunyi untuk belajar fitur",
				"natural language processing memahami bahasa manusia",
				"computer vision mengenali objek dalam gambar secara otomatis",
				"reinforcement learning mengoptimalkan keputusan melalui reward",
				"gradient descent menemukan minimum fungsi loss secara iteratif",
				"backpropagation menyesuaikan bobot jaringan secara efisien",
				"transfer learning memanfaatkan model yang sudah dilatih",
				"ensemble methods menggabungkan beberapa model untuk akurasi",
			];

			const SENTENCES_LVL6 = [
				"blockchain menyediakan buku besar yang tidak bisa dimanipulasi",
				"smart contract mengeksekusi perjanjian secara otomatis",
				"decentralized finance menggantikan sistem keuangan tradisional",
				"non fungible token merepresentasikan aset digital unik",
				"consensus mechanism menjamin konsistensi data di jaringan",
				"cryptocurrency menggunakan kriptografi untuk keamanan",
				"distributed ledger menyimpan catatan transaksi di banyak node",
				"proof of work membutuhkan daya komputasi untuk validasi",
				"proof of stake memilih validator berdasarkan jumlah stake",
				"web3 menghadirkan internet yang lebih desentralisasi",
			];

			const SENTENCES_LVL7 = [
				"quantum computing memanfaatkan prinsip mekanika kuantum",
				"qubit dapat berada dalam superposisi keadaan",
				"quantum entanglement menghubungkan qubit secara instan",
				"quantum supremacy menunjukkan keunggulan komputasi kuantum",
				"quantum algorithms menyelesaikan masalah klasik lebih cepat",
				"quantum cryptography menawarkan keamanan informasi mutlak",
				"quantum error correction memperbaiki kesalahan kuantum",
				"quantum teleportation mentransfer informasi kuantum",
				"quantum simulation memodelkan sistem kuantum kompleks",
				"quantum sensors mencapai akurasi pengukuran luar biasa",
			];

			const SENTENCES_LVL8 = [
				"artificial general intelligence meniru kecerdasan manusia",
				"neuromorphic computing meniru arsitektur otak biologis",
				"synthetic biology merekayasa sistem biologis secara digital",
				"augmented reality menggabungkan dunia nyata dan digital",
				"virtual reality menciptakan lingkungan buatan yang imersif",
				"extended reality menggabungkan berbagai teknologi realitas",
				"internet of things menghubungkan perangkat secara otomatis",
				"edge computing memproses data dekat sumber aslinya",
				"fog computing menyebarkan komputasi di lapisan jaringan",
				"cloud native architecture dirancang untuk komputasi awan",
			];

			const SENTENCES_LVL9 = [
				"quantum cryptography menawarkan keamanan mutlak berdasarkan prinsip fisika",
				"neuromorphic chips meniru cara otak memproses informasi secara efisien",
				"bioinformatics menggabungkan biologi dan ilmu komputer",
				"computational linguistics menganalisis struktur bahasa secara otomatis",
				"algorithmic trading menggunakan model matematis untuk investasi",
				"computational neuroscience mempelajari otak melalui simulasi",
				"synthetic biology merekayasa sistem biologis secara digital",
				"quantum machine learning menggabungkan komputasi kuantum dan AI",
				"topological quantum computing menggunakan anyon untuk qubit",
				"quantum error correction memperbaiki kesalahan tanpa mengganggu qubit",
			];

			const SENTENCES_LVL10 = [
				"molecular quantum computing menggunakan molekul sebagai qubit",
				"quantum neural networks menggabungkan jaringan kuantum dan klasik",
				"quantum machine learning algorithms menyelesaikan masalah klasik",
				"quantum supremacy experiments membuktikan keunggulan komputasi kuantum",
				"topological quantum field theory menggambarkan sistem kuantum",
				"quantum error correction codes melindungi informasi kuantum",
				"quantum teleportation protocols mentransfer informasi kuantum",
				"quantum cryptography protocols menjamin keamanan komunikasi",
				"quantum simulation algorithms memodelkan sistem kuantum kompleks",
				"quantum algorithmic complexity mengukur efisiensi algoritma kuantum",
			];

			// Map level to sentence arrays
			const SENTENCE_LEVELS = {
				1: SENTENCES_LVL1,
				2: SENTENCES_LVL2,
				3: SENTENCES_LVL3,
				4: SENTENCES_LVL4,
				5: SENTENCES_LVL5,
				6: SENTENCES_LVL6,
				7: SENTENCES_LVL7,
				8: SENTENCES_LVL8,
				9: SENTENCES_LVL9,
				10: SENTENCES_LVL10
			};

			let state = {
				running: false,
				startTime: null,
				sessionTime: 120, // 2 minutes
				currentSentence: "",
				sentencePool: [],
				totalCharsTyped: 0,
				correctChars: 0,
				mistakes: 0,
				kalimat: 0,
				perfect: 0,
				updateInterval: null,
			};

			function createParticles(x, y) {
				for (let i = 0; i < 5; i++) {
					const particle = document.createElement("div");
					particle.className = "particle";
					particle.style.left = x + "px";
					particle.style.top = y + "px";
					particle.style.animationDelay = i * 0.1 + "s";
					document.body.appendChild(particle);

					setTimeout(() => particle.remove(), 3000);
				}
			}

			function getDifficultySettings(level) {
				// Consistent 120-second (2-minute) sessions for all difficulties
				const sessionTime = 120;
				const pool = SENTENCE_LEVELS[level] || SENTENCE_LEVELS[1];
				return { sessionTime, pool };
			}

			function decreaseDifficulty() {
				if (state.running) return;
				const currentLevel = parseInt(document.getElementById("difficulty").value);
				if (currentLevel > 1) {
					document.getElementById("difficulty").value = currentLevel - 1;
				}
			}

			function increaseDifficulty() {
				if (state.running) return;
				const currentLevel = parseInt(document.getElementById("difficulty").value);
				if (currentLevel < 10) {
					document.getElementById("difficulty").value = currentLevel + 1;
				}
			}

			function startSession() {
				if (state.running) return;

				const level = Math.max(
					1,
					Math.min(10, parseInt(document.getElementById("difficulty").value))
				);
				const settings = getDifficultySettings(level);

				state.running = true;
				state.startTime = Date.now();
				state.sessionTime = settings.sessionTime;
				state.sentencePool = [...settings.pool].sort(() => Math.random() - 0.5);
				state.totalCharsTyped = 0;
				state.correctChars = 0;
				state.mistakes = 0;
				state.kalimat = 0;
				state.perfect = 0;

				state.currentSentence =
					state.sentencePool[
						Math.floor(Math.random() * state.sentencePool.length)
					];

				document.getElementById("inputBox").disabled = false;
				document.getElementById("inputBox").value = "";
				document.getElementById("inputBox").focus();
				document.getElementById("sentenceText").textContent =
					state.currentSentence;
				document.getElementById(
					"progressInfo"
				).textContent = `Sesi dimulai Difficulty ${level} - Good luck`;

				updateStats();
				state.updateInterval = setInterval(updateStats, 200);
			}

			function resetSession() {
				if (state.updateInterval) {
					clearInterval(state.updateInterval);
				}
				state.running = false;
				state.totalCharsTyped = 0;
				state.correctChars = 0;
				state.mistakes = 0;
				state.kalimat = 0;
				state.perfect = 0;

				document.getElementById("inputBox").disabled = true;
				document.getElementById("inputBox").value = "";
				document.getElementById("sentenceText").textContent =
					"Pilih difficulty lalu klik Start ";
				document.getElementById("progressInfo").textContent =
					"Sesi direset - Siap untuk mulai lagi";
				updateStatsDisplay(0, 0, 0, 0, 0);
			}

			function updateStats() {
				if (!state.running) return;

				const elapsed = (Date.now() - state.startTime) / 1000;
				const remaining = Math.max(0, state.sessionTime - elapsed);

				if (remaining <= 0) {
					endSession();
					return;
				}

				const minutes = Math.max(0.001, elapsed / 60);
				// WPM = (correct characters / 5) / minutes
				const wpm = Math.round((state.correctChars / 5) / minutes);

				updateStatsDisplay(
					remaining,
					wpm,
					state.kalimat,
					state.perfect,
					state.mistakes
				);
			}

			function updateStatsDisplay(remaining, wpm, kalimat, perfect, mistakes) {
				const mins = Math.floor(remaining / 60);
				const secs = Math.floor(remaining % 60);
				document.getElementById("timer").textContent = `${String(mins).padStart(
					2,
					"0"
				)}:${String(secs).padStart(2, "0")}`;
				document.getElementById("wpm").textContent = wpm;
				document.getElementById("kalimat").textContent = kalimat;
				document.getElementById("perfect").textContent = perfect;
				document.getElementById("mistakes").textContent = mistakes;
			}

			function endSession() {
				clearInterval(state.updateInterval);
				state.running = false;

				const elapsed = (Date.now() - state.startTime) / 1000;
				const minutes = Math.max(0.001, elapsed / 60);
				const wpm = Math.round((state.correctChars / 5) / minutes);

				const summary = `
                <h2 class="highscore-title">Sesi Selesai</h2>
                <div style="text-align: center; font-size: 1.2em; line-height: 2; color: #555;">
                    <p><strong>WPM:</strong> ${wpm}</p>
                    <p><strong>Kalimat:</strong> ${state.kalimat}</p>
                    <p><strong>Perfect:</strong> ${state.perfect}</p>
                    <p><strong>Mistakes:</strong> ${state.mistakes}</p>
                </div>
            `;

				document.getElementById("modalContent").innerHTML = summary;
				document.getElementById("modal").style.display = "block";
				document.getElementById(
					"progressInfo"
				).textContent = `Sesi selesai WPM: ${wpm} | Kalimat: ${state.kalimat} | Perfect: ${state.perfect}`;

				saveHighscore(wpm, state.kalimat, state.perfect);
			}

			function saveHighscore(wpm, kalimat, perfect) {
				const level = document.getElementById("difficulty").value;
				let highscores = JSON.parse(
					localStorage.getItem("typingHighscores") || "{}"
				);

				if (!highscores[level]) {
					highscores[level] = [];
				}

				highscores[level].push({
					wpm: wpm,
					kalimat: kalimat,
					perfect: perfect,
					time: Date.now(),
				});

				highscores[level].sort(
					(a, b) => b.wpm - a.wpm || b.kalimat - a.kalimat
				);
				highscores[level] = highscores[level].slice(0, 10);

				localStorage.setItem("typingHighscores", JSON.stringify(highscores));
			}

			function showHighscores() {
				const highscores = JSON.parse(
					localStorage.getItem("typingHighscores") || "{}"
				);

				if (Object.keys(highscores).length === 0) {
					document.getElementById("modalContent").innerHTML =
						'<h2 class="highscore-title">no highscore</h2><p style="text-align: center; color: #888;">Mulai bermain untuk membuat record</p>';
				} else {
					let html = '<h2 class="highscore-title">Highscores</h2>';

					Object.keys(highscores)
						.sort((a, b) => parseInt(a) - parseInt(b))
						.forEach((level) => {
							html += `<div class="highscore-section"><h3>Difficulty ${level}</h3>`;
							highscores[level].forEach((record, i) => {
								const date = new Date(record.time).toLocaleString("id-ID");
								const medal = i === 0 ? "ü•á" : i === 1 ? "ü•à" : i === 2 ? "ü•â" : "üèÖ";
								html += `<div class="highscore-item">${medal} ${i + 1}. WPM ${
									record.wpm
								} | Kalimat ${record.kalimat} | Perfect ${record.perfect} | ${date}</div>`;
							});
							html += "</div>";
						});

					document.getElementById("modalContent").innerHTML = html;
				}

				document.getElementById("modal").style.display = "block";
			}

			function closeModal() {
				document.getElementById("modal").style.display = "none";
			}

			document.getElementById("inputBox").addEventListener("input", (e) => {
				if (!state.running) return;

				const typed = e.target.value;
				let correct = 0;
				let mistakes = 0;
				let html = "";

				for (let i = 0; i < state.currentSentence.length; i++) {
					if (i < typed.length) {
						if (typed[i] === state.currentSentence[i]) {
							html += `<span class="correct">${state.currentSentence[i]}</span>`;
							correct++;
						} else {
							html += `<span class="wrong">${state.currentSentence[i]}</span>`;
							mistakes++;
						}
					} else {
						html += state.currentSentence[i];
					}
				}

				// Only count new mistakes if we're still typing the current sentence
				if (typed.length <= state.currentSentence.length) {
					state.mistakes += mistakes;
				}

				document.getElementById("sentenceText").innerHTML = html;
				state.correctChars = correct;
				state.totalCharsTyped = typed.length;

				if (typed === state.currentSentence) {
					state.kalimat++;
					
					// Check if it was a perfect sentence (no mistakes during typing)
					// We'll track this per sentence by comparing mistakes at start vs end
					if (!state.sentenceMistakes) state.sentenceMistakes = 0;
					const mistakesAtStart = state.sentenceMistakes;
					const mistakesAtEnd = state.mistakes;
					
					if (mistakesAtEnd === mistakesAtStart) {
						state.perfect++;
					}
					
					// Create particles effect
					const rect = e.target.getBoundingClientRect();
					createParticles(rect.left + rect.width / 2, rect.top);

					state.currentSentence =
						state.sentencePool[
							Math.floor(Math.random() * state.sentencePool.length)
						];
					e.target.value = "";
					document.getElementById("sentenceText").textContent =
						state.currentSentence;
					document.getElementById(
						"progressInfo"
					).textContent = `Mantap! Kalimat: ${state.kalimat} | Perfect: ${state.perfect}`;

					// Update mistake counter for next sentence
					state.sentenceMistakes = state.mistakes;
				}
			});

			window.onclick = (e) => {
				if (e.target === document.getElementById("modal")) {
					closeModal();
				}
			};
		</script>
	</body>
</html>
